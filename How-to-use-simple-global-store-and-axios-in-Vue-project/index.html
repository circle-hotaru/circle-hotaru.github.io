<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="&lt;% config.title %&gt;"><meta name="twitter:creator" content="@circlehotarux"><meta name="twitter:title" content="&lt;% page.title %&gt; | &lt;% config.title %&gt;"><meta name="twitter:description" content="&lt;% page.description %&gt;"><meta name="twitter:image" content="&lt;% page.coverpic %&gt;"><title>How to use simple global store and axios in Vue project · circlehotarux's blog</title><meta name="description" content="引言最近写的项目涉及组件间的通信，其中有一些资料是大部分组件都通用的，因此把它们抽取出来当成全局变量是最好的。在Vue项目中，state基本上意味着data，状态管理（State management)通常指应用层数据的管理。官方建议我们在小型应用中采用一个简单的store模式即可。不幸的是，官方文"><meta name="keywords" content="Blog,博客,技術,circlehotarux,mightyherox"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">circlehotarux</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">多度橙</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/categories">分类</a></li><li><a href="/tags">标签</a></li><li><a href="/baidu_verify_2ZKRTnPntf.html"></a></li><li><a href="/about/index.html">About</a></li><li class="soc"><a href="https://github.com/circle-hotaru" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="https://twitter.com/CircleHotaru" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter">&nbsp;</i></a><a href="https://www.instagram.com/circlehotarux" target="_blank" rel="noopener noreferrer"><i class="fa fa-instagram">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="http://mightyherox.me" rel="noopener noreferrer">circlehotarux</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>How to use simple global store and axios in Vue project</a></p><p class="post-meta"><span class="date meta-item">发布于&nbsp;2020-10-26</span><span class="meta-item"><i class="fa fa-comment-o"></i><span>&nbsp;</span><a href="/How-to-use-simple-global-store-and-axios-in-Vue-project/#comments">评论</a></span><span class="meta-item"><i class="fa fa-folder"></i><span>&nbsp;</span><a href="/categories/编程/" title="编程" class="a-tag">编程</a><span>&nbsp;</span></span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/Vue/" title="Vue" class="a-tag">Vue</a><span>&nbsp;</span><a href="/tags/font-end/" title="font-end" class="a-tag">font-end</a><span>&nbsp;</span><a href="/tags/simple-global-store/" title="simple global store" class="a-tag">simple global store</a><span>&nbsp;</span><a href="/tags/axios/" title="axios" class="a-tag">axios</a><span>&nbsp;</span><a href="/tags/store-pattern/" title="store pattern" class="a-tag">store pattern</a><span>&nbsp;</span><a href="/tags/store-js/" title="store.js" class="a-tag">store.js</a><span>&nbsp;</span></span></p><p class="post-abstract"><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>最近写的项目涉及组件间的通信，其中有一些资料是大部分组件都通用的，因此把它们抽取出来当成全局变量是最好的。在Vue项目中，<code>state</code>基本上意味着<code>data</code>，状态管理（State management)通常指应用层数据的管理。官方建议我们在小型应用中采用一个简单的<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/state-management.html">store模式</a>即可。不幸的是，官方文档中的介绍过于简洁，而网上找到相关中文资料也很少，甚至出现用store模式实现Vuex，天啦噜，这不就是把简单的问题复杂化了嘛。于是本文将要带领您如何使用简单的store模式。</p>
<h2 id="创建Vue项目"><a href="#创建Vue项目" class="headerlink" title="创建Vue项目"></a>创建Vue项目</h2><p>首先使用Vue Cli创建一个Vue项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create number-app</span><br></pre></td></tr></table></figure>

<p>接下来会让你选择dafault或者manual，我们选择default即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.4.6</span><br><span class="line">? Please pick a preset: (Use arrow keys)</span><br><span class="line">❯ default (babel, eslint)</span><br><span class="line">  Manually select features</span><br></pre></td></tr></table></figure>

<p>一旦项目创建完成，您需要进入项目中，然后运行该项目。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd number-app</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p>使用浏览器打开<code>http://localhost:8080/</code>，当你看到下图时表明项目已经成功跑起来了。</p>
<p><img src="https://i.loli.net/2020/10/26/S8i29qknVm1djZb.png" alt="2020-10-26_number-app初始页面.png"></p>
<p>不过我们接下来并不需要<code>HelloWorld.vue</code>，您可以把它和<code>App.vue</code>里相关部分删去。</p>
<h2 id="store-js"><a href="#store-js" class="headerlink" title="store.js"></a>store.js</h2><p>在<code>src/</code>文件夹下创建一个<code>store.js</code>文件，它将暴露一个<code>store</code>对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export const store &#x3D; &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    numbers: [1, 2, 3]，</span><br><span class="line">    text: &#39;&#39;</span><br><span class="line">  &#125;，</span><br><span class="line">  addNumber(newNumber) &#123;</span><br><span class="line">    this.state.numbers.push(newNumber);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>上面的<code>numbers</code>和<code>text</code>是我们将要在多个组件中显示或操作的数据。需要注意，所有<code>store</code>中<code>state</code>的变更，都放置在<code>store</code>自身的<code>action</code>中去管理，<code>addNumber(newNumber)</code>便是一个范例。</p>
<h2 id="在组件中使用"><a href="#在组件中使用" class="headerlink" title="在组件中使用"></a>在组件中使用</h2><p>在组件中，我们需要<code>import &#123; store &#125; from &quot;../store.js&quot;;</code>来引入<code>store</code>。在<code>data</code>中使用<code>storeState: store.state</code>来获取<code>store</code>中的<code>state</code>。</p>
<p>现在我们创建一个<code>NumberDisplay</code>组件用来显示<code>store</code>中的数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123; storeState.numbers &#125;&#125;&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; storeState.text &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; store &#125; from &quot;..&#x2F;store.js&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;NumberDisplay&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      storeState: store.state</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>然后创建一个<code>NumberSubmit</code>组件用来添加新的数字到<code>store</code>中的<code>number</code>数组。使用<code>store.addNumber</code>来调用<code>store</code>中的<code>addNumber</code>，从而改变<code>store</code>中的<code>state</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input v-model&#x3D;&quot;numberInput&quot; type&#x3D;&quot;number&quot; &#x2F;&gt;</span><br><span class="line">    &lt;button @click&#x3D;&quot;addNumber(numberInput)&quot;&gt;</span><br><span class="line">     Add new number</span><br><span class="line">    &lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; store &#125; from &quot;..&#x2F;store.js&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;NumberSubmit&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      numberInput: 0</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addNumber(numberInput) &#123;</span><br><span class="line">      store.addNumber(Number(numberInput));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>现在您可以在页面上添加新的数字了。</p>
<p><img src="https://i.loli.net/2020/10/26/z1jyrgfSBdUEZHG.png" alt="2020-10-26_number-appv1.png"></p>
<p><img src="https://i.loli.net/2020/10/26/mY2T9h5bRHDcuN3.png" alt="2020-10-26_number-app_add_number.png"></p>
<h2 id="使用axios"><a href="#使用axios" class="headerlink" title="使用axios"></a>使用axios</h2><p>有很多时候你在构建应用时需要访问一个API并展示其数据。做这件事的方法有好几种，而使用基于promise的HTTP客户端axios则是其中非常流行的一种。本文我们将使用<a target="_blank" rel="noopener" href="http://numbersapi.com/#42">Numbers API</a>，它将返回一些有趣的文本给我们。</p>
<p>在Vue项目中使用axios，首先</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save axios vue-axios</span><br></pre></td></tr></table></figure>

<p>然后在main.js中加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#39;vue&#39;</span><br><span class="line">import axios from &#39;axios&#39;</span><br><span class="line">import VueAxios from &#39;vue-axios&#39;</span><br><span class="line"></span><br><span class="line">Vue.use(VueAxios, axios)</span><br></pre></td></tr></table></figure>

<p>这样您就可以在Vue文件中通过下面的三种方式来使用axios：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Vue.axios.get(api).then((response) &#x3D;&gt; &#123;</span><br><span class="line">  console.log(response.data)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">this.axios.get(api).then((response) &#x3D;&gt; &#123;</span><br><span class="line">  console.log(response.data)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">this.$http.get(api).then((response) &#x3D;&gt; &#123;</span><br><span class="line">  console.log(response.data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>但是当我在store.js文件中使用axios时却出现了错误<code>Cannot read property &#39;get&#39; of undefined</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">addNumber(newNumber) &#123;</span><br><span class="line">    this.state.numbers.push(newNumber);</span><br><span class="line">    this.axios.get(&#39;http:&#x2F;&#x2F;numbersapi.com&#x2F;&#39;+ newNumber)</span><br><span class="line">      .then(response &#x3D;&gt; &#123;</span><br><span class="line">          this.state.text &#x3D; response.data;</span><br><span class="line">          console.log(response);</span><br><span class="line">          &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/10/26/aRJxhqF92ByVAk1.png" alt="2020-10-26_使用axios报错.png"></p>
<p>出错的原因是因为<code>store.js</code>文件中的<code>this.axios</code>并没有引用Vue实例，我们需要另外引入axios。完整<code>store.js</code>文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const axios &#x3D; require(&#39;axios&#39;);</span><br><span class="line"></span><br><span class="line">export const store &#x3D; &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    numbers: [1, 2, 3],</span><br><span class="line">    text: &#39;3 is the number of spatial dimensions we perceive our universe to have.&#39;</span><br><span class="line">  &#125;,</span><br><span class="line">  addNumber(newNumber) &#123;</span><br><span class="line">    this.state.numbers.push(newNumber);</span><br><span class="line">    axios.get(&#39;http:&#x2F;&#x2F;numbersapi.com&#x2F;&#39;+ newNumber)</span><br><span class="line">      .then(response &#x3D;&gt; &#123;</span><br><span class="line">          this.state.text &#x3D; response.data;</span><br><span class="line">          console.log(response);</span><br><span class="line">          &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/10/26/3I1JpGOx5Z4Vfba.png" alt="2020-10-26_number-app最终效果.png"></p>
<p>至此，我们完成了number-app。如果您的程序无法正常运行，请到github上查看<a target="_blank" rel="noopener" href="https://github.com/circle-hotaru/number-app">源码</a>。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过本文，我们学会了如何在Vue项目中使用简单的状态管理store，当您的项目足够简单时推荐您使用它而不是Vuex。同时我们也接触了axios，这是一个强大的工具。</p>
</p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a target="_blank" rel="noopener" href="http://twitter.com/home?status=http://mightyherox.me/How-to-use-simple-global-store-and-axios-in-Vue-project/%20circlehotarux's blog%20How to use simple global store and axios in Vue project" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/How-to-use-a-CORS-proxy-to-get-around-%E2%80%9CNo-Access-Control-Allow-Origin-header%E2%80%9D-problems/" title="如何使用CORS代理解决“No Access-Control-Allow-Origin header”问题">下一篇: 如何使用CORS代理解决“No Access-Control-Allow-Origin header”问题&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'circlehotarux-blog';
var disqus_identifier = 'How-to-use-simple-global-store-and-axios-in-Vue-project/';
var disqus_title = 'How to use simple global store and axios in Vue project';
var disqus_url = 'http://mightyherox.me/How-to-use-simple-global-store-and-axios-in-Vue-project/';
(function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//circlehotarux-blog.disqus.com/count.js" async></script></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="http://mightyherox.me" rel="noopener noreferrer">circlehotarux</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>